%%Designed for IEEE Transactions on Vehicular Technology, based on bare_jrnl.tex by Michael Shell.
%%December. 2015
%%Length Requirements: The complete manuscript should be prepared in final IEEE typesetting with maximum page length limited to 15 pages for a Regular Paper and 5 pages  for a Correspondence.
%%Contact Info: admin-tvt@ece.ufl.edu
%%Designed by TVT editorial office


\documentclass[journal,10pt]{IEEEtran}
\usepackage[cmex10]{amsmath}
\usepackage[dvips]{graphicx}
\usepackage{algorithm}
\usepackage{algorithmic}
\usepackage{array}
\usepackage{amssymb}
\usepackage{enumerate}


\newcommand{\PreserveBackslash}[1]{\let\temp=\\#1\let\\=\temp}
\newcolumntype{C}[1]{>{\PreserveBackslash\centering}p{#1}}
\newcolumntype{R}[1]{>{\PreserveBackslash\raggedleft}p{#1}}
\newcolumntype{L}[1]{>{\PreserveBackslash\raggedright}p{#1}}


\begin{document}

\title{Graph Coloring Inspired Optimal Algorithm for Wireless Energy Redistribution in WSNs}


\author{Author1, Author2, Author3

\thanks{The authors are with the Department of }% <-this % stops a space
\thanks{Manuscript received XXX, XX, 2018; revised XXX, XX, 2018.}}

\markboth{IEEE Transactions on XXX XXX,~Vol.~XX, No.~XX, XXX~2019}
{}
%{Shell \MakeLowercase{\textit{et al.}}: Bare Demo of IEEEtran.cls for Journals}


\maketitle


\begin{abstract}
Wireless energy redistribution using Wireless Power Transfer (WPT) is of key importance for enhancing Wireless Sensor Networks (WSNs). In this paper, we investigated the WPT based energy redistribution (WPTERD) problem in WSNs, which is to redistribute the energy among nodes to meet the energy demands of nodes meanwhile optimal in energy efficiency and time. We propose a two-step approach by decoupling the energy-time joint optimization into two problems named WPTERD-Egy and WPTERD-Time, which focus exclusively on the optimization in energy and time, respectively. We transform WPTERD-Egy as a linear programming (LP) problem by exploiting its properties, and obtain optimal time-lengths of the nodes' energy transmissions leading to minimum energy lost. The core of WPTERD-Time is the Energy Transmission Task Scheduling (ETTS) problem. Proving that ETTS and WPTERD-Time are both NP-hard, we propose Least neighbor-set-weight Last Sequential Scheduling (LNSWL-SS) algorithm on the inspiration of a graph coloring algorithm and upon which we solve WPTERD-Time to obtain an energy transmission schedule with approximately minimum makespan. Finally Graph Coloring inspired Egy-Time Decoupling (GC-EgyTimeD) algorithm is constructed upon LNSWL-SS for the WPTERD problem. Some approximation ratios of LNSWL-SS are obtained. Numerical simulations illustrate the effectiveness and efficiency of GC-EgyTimeD, which return schedules with minimum energy lost and approximately minimum makespan. By exploiting concurrent energy transmission opportunities, GC-EgyTimeD reduces makespan by about more than 65\% when compared with a schedule without concurrent transmissions.

\end{abstract}


\begin{IEEEkeywords}
Wireless energy redistribution problem, wireless power transfer, task scheduling problem, wireless charging, graph coloring problem.
\end{IEEEkeywords}


\IEEEpeerreviewmaketitle



\section{Introduction}
\label{sec_intro}
\newtheorem{lemma}{\textbf{Lemma}}
\newtheorem{theorem}{\textbf{Theorem}}
\newtheorem{property}{\textbf{P}}
\newtheorem{corollary}{\textbf{Corollary}}
% The very first letter is a 2 line initial drop letter followed
% by the rest of the first word in caps.
%
% form to use if the first word consists of a single letter:
% \IEEEPARstart{A}{demo} file is ....
%
% form to use if you need the single drop letter followed by
% normal text (unknown if ever used by IEEE):
% \IEEEPARstart{A}{}demo file is ....
%
% Some journals put the first two words in caps:
% \IEEEPARstart{T}{his demo} file is ....
%
% Here we have the typical use of a "T" for an initial drop letter
% and "HIS" in caps to complete the first word.

\IEEEPARstart{W}{ireless} Power Transfer (WPT) is the transmission of electric energy from a power source to a receiver without a conductor. With recent advances in WPT, it is possible to charge sensors in a relative long distance (${>}10$m away)\cite{Guo2017}. It has been validated that a sensor could harvest radio power of 6mW over a distance of 12 meters from a Wireless Charger (WC) transmitting with 4W power. The received radio power is 20mW and the transition efficiency is 30 percent~\cite{Nintana2012}. The breakthroughs in WPT technology~\cite{Kurs2007, Cannon2009} open up a new dimension to prolonging the lifetime of wireless sensor networks (WSNs). Many research efforts have been devoted to exploiting WPT to enhance WSNs~\cite{Xiang2013}-\cite{Madhja2017}. Some works focus on using WCs to power the nodes in WSNs using WPT. Due to the limited number of WCs, some nodes may could not obtain power from the WCs directly. This is true even if there are mobile WCs because of reachability restrictions or temporal failure. Hence, WPT based Energy ReDistribution (WPTERD) is a core building block for supporting perpetual WSNs.

Some recent efforts have been devoted to the application of energy exchanging among nodes in peer-to-peer mode when nodes coming into vicinity of each other during moving, so as to make the nodes' remanent energy more balanced. However, the intrinsic broadcasting feature of energy transmitting signals is not exploited, and hence leads to lower energy efficiency.

In this paper, we focus on the WPTERD problem: given a WSN consisting of nodes equipped with wireless power transceivers and limited energy storages with some initial energy, each node has its energy expectation, the task is to redistribute the energy in the WSN among all nodes through WPT, assuring that each node's final energy after the redistribution do not below its corresponding energy expectation, meanwhile the energy loss is minimized and the time-length (\textit{i.e.}, makespan) of the energy redistribution process is minimized.


We solve the WPTERD problem using a two-step approach which decouples the joint energy-time optimization into to two sub-problems named WPTERD-Egy and WPTERD-Time, as outlined in Fig.~\ref{fig_outline}. The two problems focus exclusively on the optimization in energy and time, respectively. In the first step, basing on two proved properties resulted from the widely adopted \textit{energy harvesting additive assumption}, the WPTERD-Egy problem is formalized as a Linear Programming (LP) problem, and can thus be solved to obtain the optimal time-lengths of the nodes' energy transmissions. The remanent of the WPTERD problem thus becomes the WPTERD-Time problem, which is a task scheduling problem of the nodes' energy transmissions with some restrictions of not violating some energy limits. At the core of the WPTERD problem is a Energy Transmission Task Scheduling (ETTS) problem, where the restrictions of not violating energy limits are absent. We prove that both WPTERD-Time and ETTS are NP-hard, and propose an algorithm named Least neighbor-set-weight Last Sequential Scheduling (LNSWL-SS) for solving the ETTS problem, inspired by a well known graph coloring algorithm. We build our algorithm Graph Coloring inspired Egy-Time Decoupling (GC-EgyTimeD) basing on LNSWL-SS and solutions to WPTERD-Egy and WPTERD-Time. Numerical simulations illustrate the effectiveness and efficiency of GC-EgyTimeD, which return schedules with minimum energy loss and approximately minimum makespan. Main abbreviations are listed in Table~\ref{T0} for reference.

\begin{figure}[htb]
\centering{\includegraphics[width=0.48\textwidth]{fig0_outline.eps}}
\caption{Outline of the GC-EgyTimeD algorithm to the WPTERD problem.}
\label{fig_outline}
\end{figure}

Our main contributions in this paper are as follows:

\begin{itemize}
\item{We propose the GC-EgyTimeD algorithm to solve the WPTERD problem efficiently and approximately by dividing it into WPTERD-Egy and WPTERD-Time and solve them successively. This approach exploits the broadcast nature of wireless signals well, and implicitly realizes the multi-hop energy transmission.}
\item{For the WPTERD-Egy problem, we prove that its optimal solutions must be disjoint (neighboring nodes should not transmit energy simultaneously) and no energy limit violations. These properties enable us to formulate WPTERD-Egy as a Linear Programming (LP) problem and thus can be solved easily.}
\item{For the WPTERD-time problem and the ETTS problem, we prove that they are both NP-hard by reduction from the Graph Coloring (GC) problem.}
\item{We propose the LNSWL-SS algorithm for the ETTS problem on the inspiration of the well-known Least-degree-last algorithm for the GC problem. We also prove that, for equal-radius WSNs, the approximation ratios of LNSWL-SS for 2D WSNs and 3D WSNs are 3 and 12, respectively. The approximation ratios are respectively 6 and 24 when applied to non-equal-radius WSNs.}
\end{itemize}


\begin{table}[!htbp]
\caption{Abbreviations.}
\centering
\label{T0}
\footnotesize{
\begin{tabular}
{|p{0.10\textwidth}|p{0.34\textwidth}|}
\hline
\hline
\textbf{Abbreviations} & Whole words/centences\\
\hline
\hline
WPT & Wireless Power Transfer;\\
\hline
WPTERD & Wireless Power Transfer based Energy Re-Distribution;\\
\hline
WPTERD-Egy & WPTERD problem with only the energy lost minimization objective;\\
\hline
WPTERD-Time & WPTERD problem with only the minimum makespan objective;\\
\hline
ETTS & Energy Transmission Task Scheduling problem, which is the core of WPTERD-Time but without the energy restrictions imposed by energy storage limitations;\\
\hline
LNSWL-SS & Least conflicting-neighbor-set-weight Last Sequential Scheduling algorithm for solving ETTS;\\
\hline
ETCS-S & energy-transmission concurrent set scheduling algorithm, which together with LNSWL-SS, solves WPTERD-Time;\\
\hline
GC-EgyTimeD & Graph Coloring inspired Egy-Time Decoupling algorithm  for solving WPTERD;\\
\hline
NSW & neighbor-set-weight;\\
\hline
EUL,ELL & energy-upper-limit, energy-lower-limit;\\
\hline
\hline
\end{tabular}
}
\end{table}

The rest of the paper is organized as follows. Related work is discussed in Section~\ref{sec_relwork}. The models of the problem are provided in Section~\ref{sec_model}. The WPTERD-Egy problem is analyzed and solved in Section \ref{sec_wpter_egy}. In Section~\ref{sec_wpter_time}, the WPTERD-Time problem is analyzed and the NP-hard property of ETTS and WPTERD-Time are proved. In Section~\ref{sec_solve_wpter_time}, we provide LNSWL-SS and prove its approximation ratios. GC-EgyTimeD is provided in Section~\ref{sec_algcombin}. Simulation results are provided and discussed in Section~\ref{sec_sim}. Finally a conclude is made in Section~\ref{sec_conclusion}.

\section{Related Work}
\label{sec_relwork}
Existing works using WPT most related to our work fall into two topics: (1) charging WSNs with fixed WCs; (2) energy redistribution among nodes in WSNs.

\subsection{Charging WSNs with fixed WCs}

In \cite{Xiang2013}, focusing on WSNs containing a fixed wireless charger (WC) as the only energy source for the network, the problem of distributing the energy injected from the WC among all nodes through multi-hop WPT was investigated. In the approach there, the energy transfers are modeled and formulated as multi-hop energy flows, and algorithms were proposed.

WSNs with multiple WCs and multi-hop power transfer technique were focused in \cite{Rault2013}. In this work, considering the energy demands of the nodes, the energy loss that occurs during an energy transmission, and the energy capacity limits of the WCs, the problem of determining the minimum number of WCs needed for perpetual operation of the WSN was investigated. The approach there solves the problem in two steps. In the first step, for each possible location of the WCs (WCs are embedded in nodes), a shortest-path tree rooted at this location covering the network is constructed using the Dikjstra's algorithm. Then in the second step, the problem is transformed to a Mixed Integer Linear Programming (MILP) problem making use of the trees and solved using optimization software packages.

The works in \cite{Guo2017,Guo2016} also devoted to WSNs with multiple WCs, but with an emphasis on exploiting the possibility of multiple WCs charging a single node simultaneously. A more complicated energy harvesting model considering the nonlinear superposition charging effect of simultaneously arrived energy signals was proposed there. Basing on this model, the joint charging utilities for all possible set of the WCs are pre-calculated and then be used to solve the Concurrent Charging Scheduling Problem (CCSP), whose objective is to find a schedule for the WCs so as to minimize the time spent on providing each sensor node with at least $E$ energy. The authors showed that CCSP is NP-hard, and proposed a greedy algorithm. However, only one-hop WPT is considered in these works.

Multi-hop power transmissions are quite different from multi-hop data transmissions. Different data transmissions are not equivalent since they convey different data. For power transmissions, however, energy from any source are equivalent, we need not explicitly construct paths and restrict energy flows along a certain path. In some sense, opportunistic routing in the wireless network routing realm is more suitable for energy transmission. Hence, finding other mechanisms of multi-hop WPT for charging WSNs is of importance.

\subsection{Energy Redistribution Among Nodes}

Some series of recent works \cite{Bulut2014,Niko2016,Niko2017,Madhja2016,Madhja2017} focus on a problem for mobile social and sensor networks consisting of human-carried mobile devices. In these works, energy redistribution is realized using peer-to-peer energy exchange.

Firstly in \cite{Bulut2014}, the authors investigated the problem of selecting a subset of nodes to charge the others such that all nodes can continue normal operations without battery depletion. In \cite{Niko2016}, the authors investigated the problem of efficiently reaching an energy balance among nodes distributively though peer-to-peer energy exchange. The problem was investigated in cases of two different assumptions: loss-less power exchange and lossy power exchange. Three energy exchange protocols were designed, analyzed and evaluated there. Then the problem was extended to the weighted version in \cite{Niko2017}. The uniform balance version and the weighted balance version of the peer-to-peer energy redistribution problem among star-backbone nodes in WSNs were investigated in \cite{Madhja2016} and \cite{Madhja2017}, respectively.

In these works, energy exchange only happens when two nodes coming into vicinity of each other because of the moving of the person carrying the node. As a consequence, their analyses and algorithms do not exploit the intrinsic broadcasting nature of wireless signals as well as the ability of WPT's transferring energy over a distance. Ignoring the possibility of multiple nodes simultaneously harvesting energy from a single node's energy transmitting signals inevitably leads to energy in-efficiency.


\section{System Model}
\label{sec_model}
\subsection{Problem Model}

We consider a WSN consisting of $n$ static nodes $U{=}\{u_1, u_2, \ldots, u_n\}$, where node $u_i$ is positioned at $(x(i),y(i),z(i))$. An example network is shown in Fig.\ref{fig_network}. The nodes are equipped with energy storages with limited capacity. Besides the traditional wireless transmitter/receivers (transceivers) for data communication, these nodes are all equipped with wireless energy transceivers dedicated for transmitting/harvesting energy. For each node $u_i$, $i{\in}\mathcal{N}(n)$, there is some parameters: beginning energy $e_\text{B}(i)$, final energy $e_\text{F}(i)$, energy expectation $e_\text{E}(i)$, energy upper limit $e_\text{U}(i)$, and energy lower limit $e_\text{L}(i)$. $e_\text{B}(i)$ represents node $u_i$'s initial energy amount at the beginning time; $e_\text{F}(i)$ represents $u_i$'s final energy after the energy redistribution process; $e_\text{E}(i)$ represents $u_i$'s energy expectation. $e_\text{U}(i)$ represents the capacity limit of $u_i$'s energy storage. It is required that node $u_i$'s instantaneous energy $e_{E}(i,t)$ at time $t$ should always be in range $[e_\text{L}(i),e_\text{U}(i)]$, $i{\in}\mathcal{N}(n)$, $t{\in}[0,{+}\inf]$.

We are required to redistribute the energy among the nodes by using WPT, with the objective that node $u_i$'s final energy $e_\text{F}(i)$ at the finish of the redistribution process should not below its expectation $e_\text{E}(i)$, \textit{i.e.}, $e_\text{F}(i){\geq}e_\text{E}(i)$, $i{\in}\mathcal{N}(n)$. We express this objective as $e_\text{F}{\succeq}e_\text{E}$ for short. To facilitate simulation, we further assume $e_\text{L}{\prec}e_\text{B}{\prec}e_\text{U}$, and assume $e_\text{E}(i)$ take values in range $[e_\text{E,L}(i),e_\text{E,U}(i)]$, where we have $e_\text{L}{\prec}e_\text{E,L}{\preceq}e_\text{E}{\preceq}e_\text{E,U}{\prec}e_\text{U}$. For convenient, $e_\text{U}$ is sometimes called as list or vector when no confusion, which also applies to other similar symbols. The symbols are listed in Table~\ref{T1} for easy reference.

\begin{table}[!htbp]
\caption{Symbols and meanings.}
\centering
\label{T1}
\footnotesize{
\begin{tabular}
{|p{0.05\textwidth}|p{0.38\textwidth}|}
\hline
\hline
\textbf{Notation} & Meaning\\
\hline
\hline
$\mathcal{N}(n)$ & The set of positive integers $\{1,2,\ldots,n\}$;\\
\hline
$\mathcal{R^{+}}$ & The set of positive real value in range $[0,{+}\inf]$;\\
\hline
$p, \mathbf{p}$ & The function/list/vector of the node's constant energy transmitting power, node $u_i$'s energy transmit power is $p(i)$;\\
\hline
$[.]^{\text{T}}$ & Transpose operation of the input matrix or vector;\\
\hline
$\mathbf{C}$ & The matrix of the energy harvesting coefficients $[c(i,j]_{i,j{\in}\mathcal{N}(n)}$, c(i,j) is the energy harvesting coefficient for node $u_i$ receives energy from $u_j$;\\
\hline
$\mathbf{t}$ & The vector of the nodes' energy transmitting time-lengths $\mathbf{t}{\mathop{=}\limits^\text{def}}[t(1),t(2),\ldots,t(n)]^{\text{T}}{=}[t_1),t_2),\ldots,t_n]^{\text{T}}$;\\
\hline
$e_\text{B}, \mathbf{e_\text{B}}$ & The function/list/vector of the nodes' energy at the beginning time where it is $e_\text{B}(i)$ for $u_i$.  $\mathbf{e_\text{B}}{\mathop{=}\limits^\text{def}}[e_\text{B}(1),e_\text{B}(2),\ldots,e_\text{B}(n)]^{\text{T}}$;\\
\hline
$e_\text{F}, \mathbf{e_\text{F}}$ & The function/list/vector of the nodes' final energy after the energy redistribution process finishes where it is $e_\text{F}(i)$ for $u_i$. $\mathbf{e_\text{F}}{\mathop{=}\limits^\text{def}}[e_\text{F}(1),e_\text{F}(2),\ldots,e_\text{F}(n)]^{\text{T}}$;\\
\hline
$e_\text{U}, \mathbf{e_\text{U}}$ & The function/list/vector of the nodes' energy upper limits where it is $e_\text{U}(i)$ for $u_i$. $\mathbf{e_\text{U}}{\mathop{=}\limits^\text{def}}[e_\text{U}(1),e_\text{U}(2),\ldots,e_\text{U}(n)]^{\text{T}}$;\\
\hline
$e_\text{L}, \mathbf{e_\text{L}}$ & The function/list/vector of the nodes' energy lower limits where it is $e_\text{L}(i)$ for $u_i$. $\mathbf{e_\text{L}}{\mathop{=}\limits^\text{def}}[e_\text{L}(1),e_\text{L}(2),\ldots,e_\text{L}(n)]^{\text{T}}$;\\
\hline
$e_\text{E}, \mathbf{e_\text{E}}$ & The function/list/vector of the nodes' energy expectations where it is $e_\text{E}(i)$ for $u_i$. $\mathbf{e_\text{E}}{\mathop{=}\limits^\text{def}}[e_\text{E}(1),e_\text{E}(2),\ldots,e_\text{E}(n)]^{\text{T}}$;\\
\hline
$e_\text{E,L}, \mathbf{e_\text{E,L}}$ & The function/list/vector of the nodes' lower limits of energy expectations where it is $e_\text{E,L}(i)$ for $u_i$. $\mathbf{e_\text{E,L}}{\mathop{=}\limits^\text{def}}[e_\text{E,L}(1),e_\text{E,L}(2),\ldots,e_\text{E,L}(n)]^{\text{T}}$;\\
\hline
$\mathbf{1}$ or $\mathbf{0}$ & Proper size column vectors with elements all one or all zero, respectively;\\
\hline
$\mathbf{1}_{condi}$ & The indication function of condition $condi$, which has value 1 when $condi$ is true, and 0 otherwise;\\
\hline
$N(i)$ & The set of neighbors of node $u_i$, two nodes $u_i$ and $u_j$ are neighbors of each other if $c(i,j){+}c(j,i){>}0$ ;\\
\hline
$N_\text{NSW}(v,H)$,$N_\text{NSW,n}(v,H)$ & The set of node $v$'s neighbors in graph $H$ with/without node $v$ itself;\\
\hline
$w(S)$ & The accumulated weight of the nodes in S;\\
\hline
$\varpi(G)$ & $\varpi(G){\mathop{=}\limits^\text{def}}\max_{H{\subseteq}G}(\min_{v{\in}H}w(N_{H,\text{y}}(v))$;\\
\hline
\hline
\end{tabular}
}
\end{table}

\begin{figure}[htb]
\centering{\includegraphics[width=0.48\textwidth]{fig1_network.eps}}
\caption{An example network with WPT based energy redistribution.}
\label{fig_network}
\end{figure}

Assume node $u_i$ always transmits energy with a constant power $p(i)$. When $u_i$ is transmitting energy, the energy power harvested by $u_j$ from $u_i$'s signal is expressed as $p_\text{H}(j){=}c(j,i){*}p(i)$, where the energy harvesting coefficient $c(i,j)$ embodies the effects of many factors such as the distance between nodes, environment, hardware restrictions. Energy harvesting coefficients are always non-negative. If $c(i,j){+}c(j,i){>}0$, then we say that $u_i$ and $u_j$ are neighbors. Furthermore, because of the energy conservation principle in practice, energy loss is inevitable during the wireless energy redistribution process, hence we assume $\sum_{j{\neq}i,j{\in}\mathcal{N}(n)}c(j,i){<}1$, $i{\in}\mathcal{N}(n)$. For completeness, we let $c(i,i){=}{-}1$, $i{\in}\mathcal{N}(n)$. The energy harvesting coefficients are assumed to be constant. We collect all energy harvesting coefficients into a matrix $\mathbf{C}{=}[c(i,j)]_{i,j{\in}\mathcal{N}(n)}$.

Multiple simultaneous energy transmissions encountered at a node are assumed to be additive in energy harvesting applications, which is the \textit{energy harvesting additive assumption} widely adopted in the literature\cite{He2013,Dai2017TON,Dai2018TON}. To be specific, if a set of nodes $\{u_j|j{\in}U_\text{s}\}$ transmit energy with power $\{p_j|j{\in}U_\text{s}\}$ to another node $u_j$ simultaneously, then the energy power harvested by $u_j$ is $p_\text{H}(j){=}\sum_{k{\in}U_\text{s}}c(j,k){*}p(k)$. Harvested energy should be stored in the energy storage for later use. Excessive energy harvested by a node is lost when its energy storage is full. If some harvested energy are lost at some nodes, we say that there is \textit{Energy Upper Limit (EUL) violations}. If a node's instantaneous energy becomes lower than its energy lower limit, we say that there is \textit{Energy Lower Limit (ELL) violations}. EUL violations and ELL violations are both called as energy violations.

To meet the requirement of $e_\text{F}{\succeq}e_\text{E}$, we are required to find an energy transmission schedule $s_\text{c}{\triangleq}\{s(1),s(2),\ldots\}$ where $s(i){\mathop{=}\limits^\text{def}}(u_\text{s}(i), t_\text{b}(i),t_\text{e}(i))$ represents a schedule item, which means to let node $u_\text{s}(i){\in}U$ transmit energy in time period $[t_\text{b}(i),t_\text{e}(i)]$.

Given a schedule, if each node can only transmit energy in one continuous time period, then this schedule is \textit{non-preemptive}, otherwise it is \textit{preemptive}. We mainly consider preemptive schedules in this paper. A schedule is valid if we have $e_\text{L}{\preceq}e_\text{E}(.,t){\preceq}e_\text{U}$ (\textit{i.e.}, no energy violations) during performing the schedule and $e_\text{F}{\succeq}e_\text{E}$ after performing the schedule.

A valid schedule with \textit{maximum total final energy} $E_\text{C}(s_\text{c}){=}\sum_{i{=}1}^{n}e_\text{F}(i)$ is called an \textit{optimal schedule}. It is obvious that maximizing total final energy is equivalent to \textit{minimizing energy loss}, we hence use the two phases alternatively for convenience. We denote $t_\text{E}(s_\text{c}){\mathop{=}\limits^\text{def}}\max_{i{:}s(i){\in}s_\text{c}}t_\text{e}(i)$ and call it the \textit{schedule length} of $s_\text{c}$. Short schedules are preferred. It is usually named \textit{makespan} in the literature of job/task scheduling~\cite{Marx2004}. We will use the two concepts alternatively for convenience.

\textbf{Now, we can state our WPTERD problem formally as follows}. \textit{Given a WSN consisting of a set of static nodes $U$ in a given space with energy harvesting coefficient matrix $\mathbf{C}{=}\{c(i,j)\}$, energy upper limit list $\mathbf{e}_\text{U}$ (vector), energy lower limit list $e_\text{L}$, energy transmitting power list $p$, beginning energy list $e_\text{B}$, energy expectation list $e_\text{E}$, the task is to find a valid energy transmission schedule $s_\text{c}$ with maximum total final energy $E_\text{C}(s_\text{c})$ and further with minimum makespan $t_\text{E}(s_\text{c})$}.

\subsection{Energy Harvesting Model}
The energy harvesting coefficients are determined by energy harvesting model. We adopt a model as described in Eq.\eqref{eqn_model_charge}. Here $\alpha$,$\beta$,$\gamma$ are constants affected by hardware parameters of the energy transceivers as well as the surrounding environment, and $D$ is the farthest distance that the energy transmitting signal can reach when $p{=}1$. $\gamma{\in}[2,6]$ represents the channel fading effect and is 4 in free space.

\begin{equation}
\label{eqn_model_charge}
c(d){=}\left\{
\begin{array}{ll}
\frac{\alpha}{(\beta{+}d)^{\gamma}}, \hspace{3mm}&d{\leq}D{*}p^{1/\gamma};\\
0,&d{>}D{*}p^{1/\gamma},
\end{array}
\right.
\end{equation}

The model in Eq.\eqref{eqn_model_charge} extends the model in \cite{Dai2017TON} in two aspects: (1) adds the channel fading factor $\gamma$, which consists with the popular wireless signal transmission model; (2) makes the energy coverage radius depends on energy transmitting power. Furthermore, the model can be applied to 1D, 2D, and 3D spaces.

Comment: \textit{the analyses and proposed algorithm in later sections do not depend on certain energy harvesting model. The model in Eq.\ref{eqn_model_charge} is only used in the simulation experiments in Section~\ref{sec_sim}}.

\section{Solve the WPTERD-Egy Problem}
\label{sec_wpter_egy}
To overcome the challenges, we propose a two-step approach as shown in Fig.~\ref{fig_outline} to solve the WPRERD problem by decoupling the joint energy-time optimization into two embedded sub-problems named WPTERD-Egy and WPTERD-Time, which focus exclusively on the optimization in energy and time, respectively. In the first step, based on some interesting properties of the WPTERD-Egy problem, we reformulate the WPTERD-Egy problem as a linear programming (LP) problem. The LP problem is then solved using optimization software packages to obtain an optimal solution, which contains a set of expected energy transmitting time-lengths of the nodes leading to minimum energy loss. With these results, the remanent work of the WPTERD problem becomes the WPTERD-Time problem, which is to find a schedule of energy transmission operations with minimum makespan meanwhile without energy violations. We call a continuous period of a node's energy transmission operation as an \textit{energy transmission time slice}, the WPTERD-Time problem is thus to schedule the energy transmission time slices. We use \textit{time slice} to refer to \textit{energy transmission time slice} by default for simplicity.

We will provide our analyses and treatment on the WPTERD-Egy problem in this section. The treatments on the WPTERD-Time problem are provided in later sections.

\subsection{Problem Formulation of the WPTERD-Egy Problem}

Let $S_\text{C}$ be the space of all valid energy transmission schedules. Given a schedule $s_\text{c}{\in}S_\text{C}$, we can sort all items of $t_\text{b}(i)$ and $t_\text{e}(i)$ into a list $T_\text{s}(s_\text{c}){=}[t_1,t_2,\ldots,t_{L}]$ in ascending order. Here the list is assumed to have length $L$. The time points in $T_\text{s}(s_\text{c})$ divide the time interval $[0,t_\text{L}]$ into time slots $\{ts(1),ts(2),\ldots,ts(n)\}$, where $ts(i)$ represents slot $(t_{i{-}1},t_i]$. For each slot $ts(i)$, we can obtain the set of nodes $U_\text{T}(i)$ who are scheduled to transmit energy in the slot, meanwhile all the others in $U_\text{H}(i){=}U{-}U_\text{T}(i)$ to harvest energy.

During the energy redistribution process, node $u_i$'s energy changes along time $t{\in}[0,t_{L}]$. Denoting the function of $u_i$'s energy on time $t$ and energy transmission schedule $s_\text{c}$ as $e_i(s_\text{c},t)$, then it can be expressed recursively as Eq.\eqref{eqn_energyfun_time}. The WPTERD-Egy problem can then be formulated as Eq.\eqref{eqn_wpterd_egy}.


\begin{figure*}
\begin{equation}
\label{eqn_energyfun_time}
e_i(s_\text{c},t){=}\left\{
\begin{array}{ll}
\hspace{-2mm}e_\text{B}(i), \hspace{2mm}&\hspace{-2mm}t{=}0;\\
\hspace{-2mm}\min\left\{e_\text{U}(i),
\max\left[0,
e_i(s_\text{c},t_{j{-}1})
{+}\hspace{-1mm}\left(
\mathbf{1}_{i{\in}U_\text{H}(j)}
\mathop{\sum}\limits_{k{\in}U_\text{T}(j)}p(k)c(k,i)
{-}
\mathbf{1}_{i{\in}U_\text{T}(j)}p(i)
\right)
\hspace{-1mm}(t{-}t_{j{-}1})
\right]
\right\}
,&\hspace{-2mm}t{\in}(t_{j{-}1},t_j],\\
&\hspace{-2mm}j{\in}\mathcal{N}(L);
\end{array}
\right.
\end{equation}
\end{figure*}


\begin{equation}
\label{eqn_wpterd_egy}
\begin{array}{rcl}
(\textbf{P1})&\mathop{\max}\limits_{s_\text{c}{\in}S_\text{C}}&{\sum}_{u_i{\in}U}e_i(s_\text{c},t_\text{E}(s_\text{c}))\\
&\textit{s.t.}&e_i(s_\text{c},t_E(s_\text{c})){\geq}e_\text{E}(i),\hspace{3mm}i{\in}\mathcal{N}(n);\\
&&e_i(s_\text{c},t_\text{E}(s_\text{c})){\leq}e_\text{U}(i),\hspace{3mm}i{\in}\mathcal{N}(n);\\
&&e_i(s_\text{c},t){\leq}e_\text{U}(i),\hspace{1mm}i{\in}\mathcal{N}(n),t{\in}[0,t_\text{E}(s_\text{c})];\\
&&e_i(s_\text{c},t){\geq}e_\text{L}(i),\hspace{1mm}i{\in}\mathcal{N}(n),t{\in}[0,t_\text{E}(s_\text{c})];
\end{array}
\end{equation}

The WPTERD-Egy problem has several challenges: (1) it is nonlinear due to the lower and upper limits of energy; (2) the solution space $S_\text{C}$ is infinitely larger because that the variables $t_i$ can take any real values from a continuous time interval $[0, t_\text{E}(s_\text{c})]$, and $t_\text{E}(s_\text{c})$ also required to be determined.

Further inspections show that, what significantly affect the nodes' final energy are their energy transmission time-lengths, not the beginning and ending times of the time slots. We can hence focus only on determining the optimal energy transmission time-lengths leading to minimum energy loss.

\textit{The restrictions on no energy violations during the energy redistribution process are postponed to the WPTERD-Time problem, and hence are ignored in the WPTERD-Egy problem}.

\subsection{Analyses on the WPTERD-Egy Problem}

\begin{lemma}
\label{lemma_violation}
For WPTERD problem with $e_\text{B}{\succ}e_\text{F}$, for any valid energy transmission schedule with EUL violations, there must be some valid schedules with larger total final energy.
\end{lemma}

\begin{IEEEproof}
Without loss of generality, we denote the given schedule with EUL violations as $s_0$, and assume an EUL violation is happened at node $v_0{\in}U$. Then we analyze the situation by classifying into the following two cases:

\begin{itemize}
\item{\textbf{case1: ${\exists}v_i{\in}N(v_0)$ with $e_\text{F}(v_i){<}e_\text{U}(v_i)$}}.
To generate a better schedule with no EUL violation, we assume each node is equipped with an auxiliary energy storage which can store the lost energy resulted from EUL violations. Then, after $s_0$ finishes, we can let node $v_0$ try to use-up the energy in its auxiliary storage (assume the amount of energy is $e_{v0}$) by an additional energy transmission of time-length $e_{v0}/p(v_0)$. Node $v_i$ will harvest energy $c(v_i,v_0){*}p(v_0)*{e_{v0}{/}p(v_0)}{=}c(v_i,v_0){*}e(v_0)$ from this energy transmission, and its new final energy will become $e'_\text{F}(v_i){=}\max(e_\text{F}(v_i){+}c(v_i,v_0){*}e(v_0),e_\text{U}(v_i))$. With the given condition that $e_\text{F}(v_i){<}e_\text{U}(v_i)$, we have $e'_\text{F}(v_i){>}e_\text{F}(v_i)$. Meanwhile, all other nodes' new final energy will at least not decrease. Thus, total final energy after $v_0$'s last energy transmission will be greater than that of $s_0$. Furthermore, we can obtain a new schedule $s_1$ by scheduling $v_0$'s last energy transmission to earlier times such that the violation at $v_0$ does not happens, which is true since that we can extend the makespan of the whole schedule when necessary. The new schedule $s_1$ may still have violations at other nodes, but the violation at node $v_0$ is avoided.

\item{\textbf{case2: ${\forall}v_i{\in}N(v_0)$ we have $e_\text{F}(v_i){=}e_\text{U}(v_i)$}}.
In this case, there must be a node $v_1$ with $e_F(v_1){<}e_\text{U}(v_1)$ in the network such that there is a path $\{v_0{=}a_1,a_2,\ldots,a_k{=}v_1\}$ connects $v_0$ and $v_1$, as illustrated in Fig.\ref{fig_path}. As in the previous case, we assume that each node is equipped with an auxiliary energy storage. Then, after $s_0$ finishes, we can let node $a_i$,$i{\in}\mathcal{N}(k{-}1)$, to make additional energy transmissions in turn so as to use-up the excessive energy $e_{v0}$ at $v_0$, meanwhile make $e'_\text{F}(a_i){=}e_\text{F}(a_i){=}e_\text{U}(v_i)$, $i{\in}\mathcal{N}(k{-}1)$, $e'_\text{F}(a_k){>}e_\text{F}(a_k)$. The time-lengths of the additional transmissions $t(a_i)$, $i{\in}\mathcal{N}(k{-}1)$, can be obtained by solving Eq.\eqref{eqn_violation_proof}. Furthermore, we can obtain a new schedule $s_1$ by scheduling these additional energy transmissions to earlier times such that no violations happen at $a_i$, $i{\in}\mathcal{N}(k{-}1)$.

\begin{figure*}
\begin{equation}
\label{eqn_violation_proof}
\left[\hspace{-2mm}
\begin{array}{c c c c c}
-1{*}p(a_1)          &   c(a_1,a_2){*}p(a_2)  &          \ldots    & 0      &   0\\
c(a_2,a_1){*}p(a_1)  &       -1{*}p(a_2)      &    \ldots    & 0      &    0\\
    0       &   c(a_3,a_2){*}p(a_2)         &    \ldots  & 0      &   0\\
    0       &   0           &         \ddots     &-1{*}p(a_{k{-}2})      &c(a_{k{-}2},a_{k{-}1}){*}p(a_{k{-}1})\\
    0       &   0           &            0    & c(a_{k{-}1},a_{k{-}2}){*}p(a_{k{-}2})     & -1{*}p(a_{k{-}1})\\
\end{array}
\right]
\left[
\begin{array}{c}
t(a_1)\\
t(a_2)\\
\vdots\\
t(a_{k{-}2})\\
t(a_{k{-}1}\\
\end{array}
\hspace{-2mm}
\right]
{=}
\left[
\hspace{-2mm}
\begin{array}{c}
-e_{v0}\\
0\\
0\\
\vdots\\
0\\
\end{array}
\hspace{-2mm}
\right]
\end{equation}
\end{figure*}

\end{itemize}

Combining above cases, the lemma follows.
\end{IEEEproof}

\begin{figure}[htb]
\centering{\includegraphics[width=0.48\textwidth]{fig2_path.eps}}
\caption{The path connects $v_0$ and $v_1$ where $e_\text{F}(v_1){<}e_\text{U}(v_1)$.}
\label{fig_path}
\end{figure}

\begin{theorem}
\label{theorem_no_violation}
For WPTERD problem with $e_\text{B}{\succ}e_\text{F}$, optimal energy transmission schedules with maximum total final energy (\textit{i.e.}, minimum energy loss) must have no EUL violations.
\end{theorem}

\begin{IEEEproof}
It can be proved easily by contradiction. If there is an optimal schedule $s_1$ with EUL violations, then by applying Lemma~\ref{lemma_violation} we can obtain a new better schedule $s_2$, which contradicts with the assumption that $s_1$ is optimal.
\end{IEEEproof}

\textit{For any energy transmission schedule $s_1$, if there is a set of neighboring nodes whose time slices overlap(partly or completely), then we can obtain a new schedule $s_{2}$ by just moving the overlapped time slices apart meanwhile guaranteeing that they all do not overlap with all other nodes' time slices}. This is absolutely possible since that we can always increase $t_L$ when necessary. We call a schedule where neighboring nodes' time slices do not overlap as a \textit{disjoint schedule}, otherwise an \textit{overlap schedule}.

For the relative priority of the two schedules $s_1$ and $s_2$ in term of final energy, we have the following lemma.

\begin{lemma}
\label{lemma_interval_disjoint}
For the two energy transmission schedules $s_1$ and $s_2$ obtained as above, assume they both have no EUL violations, we have $E_\text{C}(s_2){>}E_\text{C}(s_1)$.
\end{lemma}

\begin{IEEEproof}
Basing on the \textit{energy harvesting additive assumption}, and using Eq.\eqref{eqn_energyfun_time}, we analyze in the following cases:
\begin{itemize}
\item{\textbf{case1: the set of neighboring nodes whose time slices overlap only contains two nodes}}.

Assume the two neighboring nodes as $u_i$ and $u_j$. Replacing $s_1$ with $s_2$ will not affect the amount of energy harvested by any other node $u_k$, \textit{i.e.}, $e_k(s_1,t_\text{E}(s_1)){=}e_k(s_2,t_\text{E}(s_2))$, ${\forall}k{\in}\mathcal{N}(n), k{\neq}i,j$. Furthermore, the energy harvested by $u_i$ and $u_j$ from all the other nodes are kept unchanged when replacing $s_1$ with $s_2$. Now we analyze the harvested energy of $u_i$ from $u_j$ in $s_1$ and $s_2$, respectively. We assume the time-lengths of $u_i$ and $u_j$'s energy transmissions in $s_1$ are respectively $t(i)$ and $t(j)$. Furthermore, assume that the time-length of the overlapped parts of their transmissions is $t_\text{o}$. Thus, the energy harvested by $u_i$ from $u_j$ in $s_1$ is $c_{i,j}{*}p(j){*}(t(j){-}t_\text{o})$. Contrastively, the energy harvested by $u_i$ from $u_j$ in $s_2$ becomes $c_{i,j}{*}p(j){*}t(j)$. Since that $c(i,j){\geq}0$, $u_i$'s final energy $e_i(s_2,t_\text{E}(s_2)){\geq}e_i(s_1,t_\text{E}(s_1))$. The same analysis applies to $u_j$ and so we have $e_j(s_2,t_\text{E}(s_2)){\geq}e_j(s_1,t_E(s_1))$. With the fact $c_{i,j}{+}c_{j,i}{>}0$ for neighboring nodes $u_i$ and $u_j$, we know that at least one of the equations $e_k(s_2,t_\text{E}(s_2)){\geq}e_k(s_1,t_\text{E}(s_1))$, $k{\in}\{i,j\}$, strictly holds. Considering the given pre-condition that there are no EUL violations, all harvested energy will be able to be stored, hence we have.

\begin{equation}
\label{eqn_disjoint_proof}
\begin{array}{rl}
E_\text{C}(s_2)&{=}e_i(s_2,t_\text{E}(s_2)){+}e_j(s_2,t_\text{E}(s_2))\\
&\hspace{3mm}
{+}\mathop{\sum}_{{k{\in}\mathcal{N}(n),k{\neq}i,j}}e_k(s_2,t_\text{E}(s_2))\\
&{>}e_i(s_1,t_\text{E}(s_1)){+}e_j(s_1,t_E(s_1))\\
&\hspace{3mm}
{+}\mathop{\sum}_{{k{\in}\mathcal{N}(n),k{\neq}i,j}}e_k(s_1,t_\text{E}(s_1))\\
&{=}E_\text{C}(s_1).
\end{array}
\end{equation}


\item{\textbf{case2: the set of neighboring nodes whose time slices overlap contains three or more nodes}}.
Without loss of generality, we assume this set contains $k$ nodes $U_\text{s}{=}\{u_{s1},u_{s2},\ldots,u_{sk}\}$. As in case1, we can analyze the energy of each node in $U_\text{s}$ harvested from the others in $U_s$. We can thus obtain that each node's harvested energy in $s_2$ must be not smaller than that in $s_1$, and at least one strictly holds. With the fact that there are no EUL violations, we have $E_\text{C}(s_2){>}E_\text{C}(s_1)$.

\end{itemize}

Combining above cases, the lemma follows.
\end{IEEEproof}

By combining the previous Theorem~\ref{theorem_no_violation} and Lemma~\ref{lemma_interval_disjoint}, we can obtain the following theorem easily.

\begin{theorem}
\label{theorem_schedule_disjoint}
For WPTERD problem with $e_\text{B}{\succ}e_\text{F}$, optimal energy transmission schedules with maximum total final energy (\textit{i.e.}, minimum energy loss) must be disjoint.
\end{theorem}

\begin{IEEEproof}
We prove it by contradiction. Assume there is an optimal solution $s_1$ which is an overlap schedule. Theorem~\ref{theorem_no_violation} tells us that $s_1$ must have no EUL violations. Then by using Lemma~\ref{lemma_interval_disjoint} on $s_1$, we can obtain a better schedule $s_2$, which contradicts with the assumption that $s_1$ is optimal.
\end{IEEEproof}

\subsection{Reformulate and Solve the WPTERD-Egy Problem}

Theorem~\ref{theorem_schedule_disjoint} tells us that, to solve the WPTERD-Egy problem, we need only to consider disjoint schedules, which enables us to re-formulate the WPTERD-Egy problem as a more simplified linear programming (LP) problem and thus easy to solve.

Let $t_i$ be the time-length of node $u_i$'s energy transmission time slices (called as time-length of $u_i$ for short) in a schedule, and let $t{\triangleq}\{t_1,t_2,\ldots,t_n\}$ be the list of the nodes' time-lengths, then the final energy of node $u_i$ after performing the schedule can be expressed as Eq.\eqref{eqn_final_energy}. Since that we postpone the treatment for assuring no energy violations during the energy redistribution process to the time when solving the WPTERD-Time problem, the restriction of the energy limits can be only applied to the final energy $e_\text{F}$ here.

\begin{equation}
\label{eqn_final_energy}
\begin{array}{rl}
e_\text{F}(i){=}e_\text{B}(i){-}p(i)t_i
{+}&\mathop{\sum}\limits_{\substack{j{\in}\mathcal{N}(n),\\j{\neq}i}}
c(i,j)p(j)t_j,i{\in}\mathcal{N}(n)\\
\end{array}
\end{equation}

The WPTERD-Egy problem for determining $\mathbf{t}$ can then be expressed as \textbf{P2} in Eq.\eqref{eqn_p2}.

\begin{equation}
\label{eqn_p2}
\begin{array}{rcll}
(\textbf{P2})&\mathop{\max}\limits_{t{=}\{t_1,t_2,\ldots,t_n\}}&{\sum}_{i{\in}\mathcal{N}(n)}e_\text{F}(i)\\
&\textit{s.t.}
&Eq.\eqref{eqn_final_energy};&\\
&&e_\text{F}(i){\geq}e_\text{E}(i),&i{\in}\mathcal{N}(n);\\
&&e_\text{F}(i){\leq}e_\text{U}(i),&i{\in}\mathcal{N}(n);\\
&&t_i{\geq}0,&i{\in}\mathcal{N}(n).
\end{array}
\end{equation}

Using the matrix and vector symbols defined in Table \ref{T1}, problem \textbf{P2} can be expressed in matrix form as \textbf{P3} in Eq.\eqref{eqn_p3}.

\begin{equation}
\label{eqn_p3}
\begin{array}{rcl}
(\textbf{P3})&\mathop{\max}\limits_{\mathbf{t}}&\mathbf{1}^\text{T}{*}\mathbf{e_\text{F}}\\
&\textit{s.t.}
&\mathbf{e_\text{B}}{+}\mathbf{C}{*}\mathbf{p}{*}\mathbf{1}^{\text{T}}{*}\mathbf{t}{=}\mathbf{e_\text{F}};\\
&&\mathbf{e_\text{F}}{\succeq}\mathbf{e_\text{E}};\\
&&\mathbf{e_\text{F}}{\preceq}\mathbf{e_\text{U}};\\
&&\mathbf{t}{\succeq}0.
\end{array}
\end{equation}

Problem \textbf{P2} (\textit{i.e.}, \textbf{P3}) is a standard LP problem, which can be solved efficiently using mature software optimization packages, such as Gurobi, Cplex, Nlopt, etc.

\section{Analyses of the WPTERD-Time Problem}
\label{sec_wpter_time}
Given an energy transmission schedule, we can group the schedule items into sets $S^{i}{=}\{s^{i}_1, s^{i}_2, \ldots, s^{i}_{m_i}\}$, $i{\in}\mathcal{N}(n)$. Here set $S^{i}$ contains $m_i$ schedule items, where node $u_i$ should transmit energy. Thus, the total energy transmission period of $u_i$ contains $m_i$ time slices with lengths $t_\text{e}(s^{i}_j){-}t_\text{b}(s^{i}_j)$, $j{\in}\mathcal{N}(m_i)$.

Once the energy transmission time-lengths of the nodes have been determined, the remanent work to solve the WPTERD problem is to schedule the nodes' energy transmission time slices along the time line, with the objection that the makespan of the schedule is minimum meanwhile no energy violations happen during the process. This is the WPTERD-Time problem, which is what the second step will solve. EUL-violations lead to energy loss thus destroying the energy optimality. ELL-violations lead to invalid schedule.

To minimize the makespan of a schedule, we should try to make energy transmission time slices overlap along the time line. However, to preserve energy optimality of a schedule, the time slices of neighboring nodes should not overlap with each other, according to Theorem \ref{theorem_schedule_disjoint}.

The WPTERD-Time problem can be stated formally as follow. \textit{Given a set of static nodes $\textbf{U}$ in a given space with energy harvesting coefficient matrix $\mathbf{C}{=}\{c(i,j)\}$, energy storage capacity limit list $\textbf{e}_\text{U}$ (vector), energy storage lower limit list $\textbf{e}_\text{L}$, energy transmitting power list $\textbf{p}$, beginning energy list $\textbf{e}_\text{B}$, energy expectation list $\textbf{e}_\text{E}$, energy transmission time-length vector $\textbf{t}$, the task is to find a time slice schedule $s_c$ for $\textbf{t}$ with minimum makespan, meanwhile no energy violation happens during the process}. It can be formulated as Eq.\eqref{eqn_wpterd_time}.

\begin{equation}
\label{eqn_wpterd_time}
\begin{array}{rl}
(\textbf{P4})&\mathop{\min}_{s_\text{c}{\in}S_\text{C}}{\max}_{s(i){\in}s_\text{c}}t_\text{e}(i)\\
\textit{s.t.}&e_i(s_\text{c},t_\text{E}(s_\text{c})){\geq}e_\text{E}(i),\hspace{3mm}i{\in}\mathcal{N}(n);\\
&e_i(s_\text{c},t_\text{E}(s_\text{c})){\leq}e_\text{U}(i),\hspace{3mm}i{\in}\mathcal{N}(n);\\
&e_i(s_\text{c},t){\leq}e_\text{U}(i),\hspace{3mm}i{\in}\mathcal{N}(n),t{\in}[0,t_\text{E}(s_\text{c})];\\
&e_i(s_\text{c},t){\geq}e_\text{L}(i),\hspace{3mm}i{\in}\mathcal{N}(n),t{\in}[0,t_\text{E}(s_\text{c})];\\
&[t_\text{b}(i),t_\text{e}(i)]{\cap}[t_\text{b}(j),t_\text{e}(j)]{=}\emptyset,u_\text{s}(i){=}u_\text{s}(j)\\
&\hspace{13mm},s_i,s_j{\in}s_c;\\
&[t_\text{b}(i),t_e(i)]{\cap}[t_\text{b}(j),t_e(j)]{=}\emptyset,u_s(i){\neq}u_s(j)\\
&,c(u_\text{s}(i),u_\text{s}(j)){+}c(u_\text{s}(j),u_\text{s}(i)){>}0,s_i,s_j{\in}s_\text{c};\\
&\sum_{\left\{\substack{s(j){=}i,\\s(j){\in}s_\text{c}}\right\}}\left(t_e(j){-}t_b(j)\right){=}t(i),\hspace{3mm}i{\in}\mathcal{N}(n);\\
&0{\leq}t_\text{b}(i){<}t_\text{e}(i),\hspace{3mm}s_i{\in}s_\text{c};
\end{array}
\end{equation}

In the WPTERD-Time problem, besides the energy limit restrictions, the main restrictions are that neighboring nodes' time slices should not overlap. The neighboring information of the WPTERD-Time problem can be more conveniently expressed as a graph $G(V,E)$ defined as Eq.\eqref{eqn_graph_conflict}. This graph is usually called \textit{conflict graph} in the literature of task scheduling.

\begin{equation}
\label{eqn_graph_conflict}
\left\{
\begin{array}{lcll}
V(G){=}\{&u_i\hspace{-3mm}&|\hspace{1mm}i{\in}\mathcal{N}(n)\},\\
E(G){=}\{&e(i,j)\hspace{-3mm}&|\hspace{1mm}c(i,j){+}c(j,i){>}0,i{\in}\mathcal{N}(n)\}.\\
\end{array}
\right.
\end{equation}

The WPTERD-Time problem contains the following energy transmission task scheduling (ETTS) problem as its core: \textit{Given a set of $n$ energy transmission tasks with time vector $t{=}[t_1,t_2,\ldots,t_n]$ and the corresponding conflict graph $G(V,E,W)$, to find an energy transmission task schedule with minimum makespan}. The ETTS ignores the restrictions on energy violations, we can however solve the WPTERD-Time problem basing on a solution to the ETTS problem. Unfortunately, the ETTS problem is hard to solve, as shown in the following Theorem \ref{lemma_etts_npc}, which is proved by inducing from the well-known NP-hard graph coloring (GC) problem.

\begin{theorem}
\label{lemma_etts_npc}
The ETTS problem is NP-hard.
\end{theorem}

\begin{IEEEproof}
We prove it by providing a polynomial reduction from the NP-hard GC problem to the ETTS problem. The GC problem is to find a coloring for a given graph $G(V,E)$ with minimum number of colors. A coloring of $G$ using $k$ colors is a function $c{:}V{\rightarrow}\mathcal{N}(k)$ such that adjacent vertices in $G$ are assigned with different colors.

For a GC problem instance with graph $G(V,E)$, we construct an ETTS problem instance with $|V(G)|$ unit-length tasks and conflict graph $G(V,E)$, and its time-length vector is all 1. The construction of the ETTS problem instance from the GC problem instance is obviously polynomial. Furthermore, there is a one-to-one map between the coloring solutions of the GC instance and the task schedules of the ETTS instance. To be specific, we divided the time line in the ETTS problem into time slots with unit length, then for each graph coloring solution, we can let the nodes colored 1 transmit energy in the 1st time slot, and then those nodes colored 2 transmit in the 2nd slot, and so on. The makespan of the such an ETTS solution equals the number of the colors in the GC solution. As a conclusion, there is a polynomial reduction from the NP-hard GC problem to our ETTS problem.
\end{IEEEproof}

\begin{theorem}
\label{lemma_wpterd_time_npc}
The WPTERD-Time problem is NP-hard.
\end{theorem}

\begin{IEEEproof}
We prove it by providing a polynomial reduction from the ETTS problem to the WPTERD-Time problem.

For the ETTS problem with conflict graph $G(V,E)$ and task time-length list $\mathbf{t}$, we can construct a WPTERD-Time instance with parameters constructed as follows. Use any matric as $\mathbf{C}$ on condition that it satisfies: (1) diagonal elements take value -1; (2) all elements corresponding to edges in $G$ take values from (0,1), and all other elements take value 0; (3)$c(i,j){+}c(j,i){>}0$, ${\forall}(i,j){\in}E(G)$. Furthermore, $e_\text{L}{=}0$, $e_\text{U}{=}\inf$, $p{=}1$, $e_\text{B}{=}\max(\mathbf{t}){+}1$, and $e_\text{E}{=}e_\text{B}{+}\mathbf{C}{*}\mathbf{t}$. This can obviously be done in polynomial time. Furthermore, it is easy to check that any schedule to the ETTS instance is a valid energy transmission schedule to the WPTERD-time problem constructed above, and vise visa. In other words, the solutions to the ETTS instance and those to the WPTERD-Time instance have a one-to-one map. The theorem follows.
\end{IEEEproof}

\section{Solve the WPTERD-Time Problem}
\label{sec_solve_wpter_time}

Theorem~\ref{lemma_etts_npc} and Theorem~\ref{lemma_wpterd_time_npc} imply that no polynomial algorithms can solve the WPTERD-Time problem and the ETTS problem optimally. Our approach is to approximately solve it in two steps. In the first step, it solves the ETTS problem to obtain the collection of Energy-Transmission Concurrent (ETC) sets. An ETC set is a set of nodes that is scheduled to transmit energy concurrently for a certain time-length associated with the set. Step 1 just returns a collection of ETC sets, whereas the sequence of the energy transmissions is postponed to the second step, which determines the operation sequence of the ETC sets assuring no EUL and ELL violations. The two steps are implemented as algorithms named as LNSWL-SS and ETCS-S, as shown in Fig.~\ref{fig_outline}.

\subsection{Step1: The LNSWL-SS Algorithm for the ETTS Problem}

Inspired by the smallest-degree-last algorithm \cite{Marathe1995} for approximately solving the GC problem, we propose LNSWL-SS for the ETTS problem, which is a three-step algorithm. In the first step, it determines a sequence in which nodes having least neighbor-set-weight (NSW) are ordered at last. Hence we name it Least NSW Last Sequential Scheduling (LNSWL-SS) algorithm. Here a node's NSW means the sum of the weights of the node's neighbors. Then in the second step, it makes schedule decisions for the tasks greedily following this sequence. When making schedule decisions for each task, it is scheduled to run in any time slice not occupied by any of its neighbors already scheduled. Finally it returns the list of schedule items in format of 2-tuple (concurrent-task-set, time-length). A such schedule item represents a decision that the nodes in concurrent-task-set should transmit energy concurrently for time time-length. LNSWL-SS works a weighted graph $G(V,E,W)$ which encapsulates the ETTS problem's conflict graph $G(V,E)$ and task time-length vector \textbf{t} by assigning weight $W(i){=}t(i)$.

The pseudo code of LNSWL-SS is shown in Alg.~\ref{Alg_LNSWL_SS}. The while-loop between code lines 2-7 implements the first step. A property value of graph $G$, defined as $\varpi(G){\mathop{=}\limits^{\text{def}}}\max_{H{\subseteq}G}(\min_{v{\in}H}w(N_\text{NSW}(v,H)$, is also obtained accompanyingly, which denotes the largest $\varpi$ such that $G$ contains a subgraph $H$ in which each node's NSW is at least $\varpi$. The for-loop between code lines 8-10 implements the second step. Code lines 12-15 implements the last step.

\begin{algorithm}[!htb]
\caption{LNSWL-SS algorithm for the ETTS problem}
\begin{algorithmic}[1]\label{Alg_LNSWL_SS}
    \REQUIRE $G(V,E,W)$: weighted graph of the problem;\\
    \ENSURE $\varpi(G)$; $S_\text{si}$: the set of schedule items;
    $S_\text{cts}$: the collection of (concurrent-task-set, time-length) schedule items;\\
    \STATE Initialize $G'{=}G(V,E)$, $\varpi(G){=}0$, $v_\text{List}{=}[ ]$;
    \WHILE {$G'{\neq}\emptyset$}\label{seqbegin}
        \STATE $\varpi(G){=}\max(\varpi(G),\min_{v_j{\in}V(G')}w_\text{N}(G',v_j))$;\label{v_update}
        \STATE $v_i{=}\arg\min_{v_j{\in}V(G')}w_\text{N}(G',v_j)$; $v_{List}=[v_i,v_\text{List}]$;
        \STATE $V'{=}V(G'){-}v_i$; $E'{=}E(G'){-}\{e(i,k)|e(i,k){\in}V(G')\}$;
        \STATE $G'{=}G(V',E')$;
    \ENDWHILE \label{seqend}
    \FOR {$i{=}1{:}n$} \label{schbegin}
        \STATE Assign all time slices unused by any scheduled items of the nodes in $N(G',v_i)$, and insert the corresponding schedule items into $S_\text{si}$;
    \ENDFOR \label{schend}
    \STATE Sort the beginning and ending time values of all items in $S_\text{si}$ into a list $T_\text{s}(s_\text{c}){=}[t_1,t_2,\ldots,t_{L}]$ in ascending order(here assume its length is $L$), we thus obtain $L{-}1$ time slots with slot $i$ occupies time interval $(t_{i},t_{i{+}1}]$.\label{ctsbegin}
    \FOR {$1{=}1{:}1{:}L{-}1$}
        \STATE Obtain the set $U_\text{T}(i)$ of concurrent tasks in time slot $i$;
        \STATE $S_\text{cts}(i).CTS{=}U_\text{T}(i)$;$S_\text{cts}(i).tLen{=}t_{i{+}1}{-}t_{i}$;
    \ENDFOR \label{ctsend}
    \STATE \textbf{return} $S_\text{si}, S_\text{cts}, \varpi(G)$;
\end{algorithmic}
\end{algorithm}

\subsection{Performance Ratio of the LNSWL-SS Algorithm}

The quality of the solutions returned by an approximate algorithm can be coarsely implied by its performance ratio. Performance ratio of an algorithm for an maximization (minimization) problem is a constant $\rho{\leq}1({\geq}1)$ such that, for any problem instance, the value of any solution returned by the algorithm is at least (at most) ${\rho}$ times of the optimal value.

For general graphs, the graph coloring problem is NP-hard even for any fixed number of colors $k{\geq}3$~\cite{Garey1979}. Furthermore, it is hard to approximate, \textit{i.e.}, the problem of approximating the chromatic number with any constant ratio is also NP-hard~\cite{Arora1998}. Fortunately, for the ETTS problem embedded in the WPTERD-Time problem, whose conflict graph is the intersection graph of the nodes' energy signal coverage disks, our LNSWL-SS algorithm has constant approximation ratios. We denote the makespan of the solution returned by LNSWL-SS for the ETTS problem as $m_\text{LNSWL}$, and denote the makespan of the corresponding optimal solution as $m_\text{OPT}$.

\begin{lemma}
\label{lemma_valid_solution}
The solution returned by LNSWL-SS for the ETTS problem must have makespan $m_\text{LNSWL}$ not greater than $\varpi(G)$.
\end{lemma}

\begin{IEEEproof}
To prove that $m_\text{LNSWL}{\leq}\varpi(G)$ is equivalent to prove that all time slices of the nodes in a schedule returned by LNSWL-SS must fall into time interval $[0,\varpi(G)]$. We will prove it by induction. LNSWL-SS determines the time slices of the nodes in the sequence of $v_\text{List}[1{:}n]$. For the first node $v_\text{List}(1)$, its energy transmission operation can definitely be scheduled in $[0,\varpi(G)]$. Now assume that the scheduled time slices for the nodes in $v_\text{List}[1{:}i]$ are all in $[0,\varpi(G)]$. According to the definition of $\varpi(G)$ and the construction of the list $v_\text{List}[1{:}n]$, we must have $w(N(v_\text{List}(i{+}1))){\leq}\varpi(G)$, otherwise $\varpi(G)$ will be updated as $\varpi(G){=}w(N(v_\text{List}(i{+}1)))$ by code line3 in Alg.~\ref{Alg_LNSWL_SS} at that time. Hence, we can surely schedule node $v_\text{List}(i{+}1)$'s energy transmission operations in between the time slices occupied by its neighbors in $[0,\varpi(G)]$. The lemma follows.
\end{IEEEproof}

We call a WSN where all nodes' energy signal coverage disks have equal radius as an equal-radius WSN, whereas other WSNs are called as non-equal-radius WSNs.

\begin{lemma}
\label{lemma_2d_ratio3}
For equal-radius WSNs in 2D space, the approximation ratio of LNSWL-SS is 3.
\end{lemma}

\begin{IEEEproof}
Our proof mimics the proof of the theorem in \cite{Marathe1995}. First, the makespan $m_\text{OPT}$ of any optimal schedule must not be smaller than the weight $w_{c,G}$ of the maximum clique, we have Eq.\eqref{eqn_pr_2d3_1}.

\begin{equation}
\label{eqn_pr_2d3_1}
m_\text{OPT}{\geq}w_{c,G}
\end{equation}

Let $H$ be a subgraph of $G$ where the nodes' NSWs are at least $\varpi(G)$, and let $v^{*}{\in}H$ be the node having smallest NSW. Using the definition of $\varpi(G)$ and Lemma \ref{lemma_valid_solution}, we have Eq.\eqref{eqn_pr_2d3_2}.

\begin{equation}
\label{eqn_pr_2d3_2}
w_\text{NSW}(v^{*},H){\geq}\varpi(G){\geq}m_\text{LNSWL}
\end{equation}

Since that $v^{*}$ has the smallest $Y$-coordinate in $H$, all nodes in $H$ must be in the half plane above the horizontal line through node $v^{*}$. Let $r$ be the radius of the nodes' energy signal coverage disks. We divide the top half disk with radius $r$ centered at $v^{*}$ into three equal sectors as shown in Fig.\ref{fig_2d3part}, where the blank circles represent the nodes in $N(v^{*},H)\mathop{=}\limits^\text{def}H{\cap}N(v^{*})$. The nodes on the division lines can be assumed to be in either of the two adjacent sectors deterministically.

\begin{figure}[htb]
\centering{\includegraphics[width=0.25\textwidth]{fig_2d3part.eps}}
\caption{Divide the top half disk into 3 sectors.}
\label{fig_2d3part}
\end{figure}

Because that all nodes have energy signal coverage radius $r$, the nodes in each sector must form a clique. Denote the node set in the three sectors as $S_1$, $S_2$, and $S_3$, respectively. Assume the maximum clique of $G$ has weight $w_{c,G}$, then we have Eq.\eqref{eqn_pr_2d3_3}.

\begin{equation}
\label{eqn_pr_2d3_3}
\begin{array}{rcl}
w_\text{NSW}(v^{*},H)&{=}&w(S_1{\cap}H{+}S_2{\cap}H{+}S_3{\cap}H{-}2{*}w(v^{*}))\\
&{\leq}&w(S_1{\cap}H{+}S_2{\cap}H{+}S_3{\cap}H)\\
&{=}&w(S_1{\cap}H){+}w(S_2{\cap}H){+}w(S_3{\cap}H)\\
&{\leq}&3{*}w_{c,G}
\end{array}
\end{equation}

Combining the equations from Eq.\eqref{eqn_pr_2d3_1} to Eq.\eqref{eqn_pr_2d3_3}, we obtain $m_\text{LNSWL}{\leq}3{*}m_\text{OPT}$, \textit{i.e.}, the performance ratio of LNSWL-SS is 3. The lemma follows.
\end{IEEEproof}

\begin{lemma}
\label{lemma_3d_ratio12}
For equal-radius WSNs in 3D space, the approximation ratio of LNSWL-SS is 12.
\end{lemma}

\begin{IEEEproof}
The proof is similar to that in the previous lemma but with some adaptations to the 3D space. The differences lie in the following aspects: (1) $v^{*}$ represents the node with smallest $Z$ coordinate value in $H$; (2) divide the top half sphere into 12 sectors as shown in Fig.\ref{fig_3d12part} (firstly use the planes $X{=}0$ and $Y{=}0$ to split the top half sphere into 4 equal sectors, then divide each sector into 3 sectors further using three planes, each of which contains the line through point (0,0,0) and the center point of the sector's spherical face meanwhile perpendicular to the splitting planes).

\begin{figure}[htb]
\centering{\includegraphics[width=0.25\textwidth]{fig_3d12part.eps}}
\caption{Divide the top half sphere into 12 sectors.}
\label{fig_3d12part}
\end{figure}

It is easy to notice that any two points in any of the 12 sectors has distance not greater than $r$. For example, the distances between the points $A$, $D$, $E$, $F$ in Fig.\ref{fig_3d12part} can be obtained easily as follows.

\begin{equation}
\label{eqn_pr_3d12_1}
\begin{array}{rll}
l_{DA}{=}&\hspace{-3mm}r\sqrt{(\frac{1}{\sqrt{3}})^2{+}2*(\frac{1}{\sqrt{3}})^2}&{\approx}0.9194r{<}r\\
l_{DE}{=}l_{DF}{=}&\hspace{-3mm}r\sqrt{2(\frac{1}{\sqrt{2}}{-}\frac{1}{\sqrt{3}})^2{+}(\frac{1}{\sqrt{3}})^2}&{\approx}0.6058r{<}r\\
l_{EF}{=}&\hspace{-3mm}r\sqrt{2{*}(\frac{1}{\sqrt{2}})^2}&{=}r
\end{array}
\end{equation}

Because that the four nodes are extreme nodes in the sector, the distance between any points in the sector must be not longer than $\max\{l_{DA},l_{DE},l_{DF},l_{EF}\}{<}r$. Thus, all nodes in each section must form a clique.

Applying the analysis process in proving Lemma~\ref{lemma_2d_ratio3} to the 3D case with above adaptations, we obtain $\frac{m_\text{LNSWL}}{m_\text{OPT}}{\leq}12$.
\end{IEEEproof}

\begin{lemma}
\label{lemma_2d3d_ratio}
For non-equal-radius WSNs in 2D (3D) space, the approximation ratio of LNSWL-SS is 6 (24).
\end{lemma}

\begin{IEEEproof}
These can be proved by applying some adaptations for non-equal-radius WSNs to the analysis process used in the previous lemmas. To be specific, assume $H$ is a subgraph of $G$ such that the nodes' NSWs in $H$ are at least $\varpi(G)$.

Assume $v^{*}{\in}H$ is the node with the smallest radius $r_1$. All other nodes in $H$ must lie around $v^{*}$ instead of in a half space around $v^{*}$. For assuring that all nodes in a sector form a clique, for the 2D case, we divide the disk centered at $v^{*}$ with radius $r_1$ into 6 equal sectors as in Fig.\ref{fig_spacearound_div}(a). For the 3D case, we divide the sphere centered at $v^{*}$ with radius $r_1$ into 24 equal sectors as in Fig.\ref{fig_spacearound_div}(b). Because that $v^{*}$ has the smallest radius, the nodes in $H$ fall into each sector form a clique.

\begin{figure}[htb]
\centering{
\begin{minipage}[c]{0.22\textwidth}
\centering{
\vspace{4.5mm}\includegraphics[width=\textwidth]{fig_2d6part.eps}}
\parbox{\linewidth}{\centering\small{(a) 6 sectors in 2D WSN}}
\end{minipage}%
\hspace{0.01\textwidth}%
\begin{minipage}[c]{0.22\textwidth}
\centering{\includegraphics[width=\textwidth]{fig_3d24part.eps}}
\parbox{\linewidth}{\centering\small{(b) 24 sectors in 3D WSN}}
\end{minipage}
}
\caption{Divide the space around $v_{*}$ with radius $r_1$ equally.}
\label{fig_spacearound_div}
\end{figure}

With these adaptations, we can obtain the lemma by applying the analysis used in proving previous lemmas.
\end{IEEEproof}

\subsection{Step2: Schedule Considering Energy Limits}

This step determines a \textit{(set,time)} sequence of energy transmission time slices, where the \textit{set} in a sequence item determines a set of nodes that should transmit energy simultaneously, and the \textit{time} in the item determines the length of the time slice. We propose the Energy-Transmission Concurrent Set Scheduling (ETCS-S) algorithm to determine the schedule sequence making use of the collection of concurrent task sets obtained by LNSWL-SS.

The pseudo code of ETCS-S is shown in Alg.~\ref{Alg_ETCS_S}. It firstly inserts all items in $S_\text{cts}$ obtained by LNSWL-SS into a queue. We call these items as candidate schedule items. ETCS-S determines the available time-slice length $t3$ for the candidate schedule items in the queue in turn (code lines 4-14). $t3$ is mainly determined by whichever is the earliest among the three values: (1) the earliest time that one node's remaining time (which means the difference between the required time-length and the accumulated time-lengths of already scheduled items for the node) becomes 0 (code line 4); (2)the earliest time that some node reaches its lower energy limit $e_\text{L}$ (code line 5); (3) the earliest time that some node reaches its upper energy limit, which is determined using the bisection search method when necessary (code lines 8-14). The other lines update the candidate schedule items correspondingly and generating new candidate schedule items when necessary determined using a threshold parameter $num_\text{lim}$.

\begin{algorithm}[!htb]
\caption{The ETCS-S algorithm}
\begin{algorithmic}[1]\label{Alg_ETCS_S}
    \REQUIRE $S_\text{cts},\mathbf{e_B}, \mathbf{e_U}, \mathbf{e_L}, \mathbf{e_E}, \mathbf{C}, \mathbf{p}$;\\
    \ENSURE $TS_\text{ss}$: the time-set schedule sequence;\\
    \STATE $num(i)=0, {\forall}u_i{\in}U$; enQueue($Q,S_\text{cts}$); \\
    \WHILE {nonEmpty($Q$)}
        \STATE $s1{=}$deQueue$(Q)$;
        \STATE $i_1{=}\arg \min_{i{\in}s1.CTS}t(i)$; $t_1{=}t(i_1)$; \label{line_timelen_time}
        \STATE $i_2{=}\arg \min_{i{\in}s1.CTS}(e_t(i){-}e_\text{L}(i))/p(i)$; $t_2{=}(e_t(i_2){-}e_\text{L}(i_2))/p(i_2)$; \label{line_timelen_emin}
        \IF {$t_2{>}0$}
            \STATE $t3{=}\min\{t_1,t_2\}$;
            \STATE $e_{t1}{=}e_t{-}\mathbf{C}{*}\mathbf{p}{*}tv_{s1.CTS}(t3)$;
            \WHILE {${\exists}i{\in}N(s1.CTS), e_{t1}(i){>}e_\text{U}(i)$}
                \STATE Find the maximum $t3$ that leads to no EUL-violation using the bisection method;\label{line_timelen_emax}
                \IF {$t3{<}\epsilon$}
                    \STATE $t3{=}\epsilon$;\textbf{break};\label{slicelen2epsilon}
                \ENDIF
            \ENDWHILE
            \STATE $e_{t}{=}e_t{-}\mathbf{C}{*}\mathbf{p}{*}tv_{s1.CTS}(t3); e_{t}{=}\min{(e_{t},e_\text{U})}$;
            \STATE $t(i){=}t(i){-}t3, i{\in}s1.CTS$;
            \STATE $st1.CTS{=}s1.CTS$; $st1.tLen{=}t3$;
            \STATE $ST_\text{ss}{=}[ST_\text{ss},st1]$;$s1.tLen{=}s1.tLen{-}t3$;
            \STATE $s1.CTS{=}\{i|i{\in}s1.CTS, t(i){>}0\}$;
            \IF {$s1.tLen{>}0$}
                \STATE enQueue$(Q,s1)$;
            \ENDIF
        \ELSE
            \STATE $num(i_2){=}num(i_2){+}1$;
            \IF {$num(i_2)>num_\text{lim}$}
                \STATE $s1.CTS{=}\{i_2\}$; $s1.tLen{=}s1.tLen$;
                \STATE enQueue$(Q,s1)$;
            \ENDIF
        \ENDIF
     \ENDWHILE
     \STATE \textbf{return} $ST_\text{ss}$;
\end{algorithmic}
\end{algorithm}

There are cases that two neighboring nodes are both with full energy $e_\text{B}{=}e_\text{U}$ before the re-distribution. In this case, the bisection search (code lines 9-14 in Alg.~\ref{Alg_ETCS_S}) will fail to return a positive value. In fact, there is no way to avoid EUL-violation while keeping the energy optimality. One such case is shown in Fig.\ref{fig_full}. The parameters are as follows: energy upper limit $e_\text{U}{=}[10,10,10]$, energy at the beginning $e_\text{B}{=}[10,10,1]$, energy expectation $e_\text{E}{=}[6,6,2]$, and energy transmission power $p{=}[1,1,1]$. It is easy to check that the optimal energy transmission time-length solution to the corresponding WPTERD-Egy problem is $t{=}[5,5,0]$. However, whichever of the two nodes, $u_1$ and $u_2$, performs the energy transmission first, EUL-violation will happen at the other node. To solve this dilemma, we compromise the energy optimality by allowing a short time period $\epsilon$ for energy loss/overflow (code lines 11-13). After that period, the two nodes can perform energy transmissions alternatively: one node keeps transmitting until the other reaches its EUL, or its energy transmission time expectation is used up. We call this scheme as $\epsilon${-}scheme. The energy changing processes along time of the nodes using this scheme are shown in Fig~\ref{fig_full_sch}. Since that energy harvesting coefficient is quite small, the time-length of a node's continuous energy transmission time slice will increase rapidly. With small enough $\epsilon$, the amount of energy loss may be trivial. Indeed, the energy loss approaches 0 as $\epsilon{\rightarrow}0$.

\begin{figure}[htb]
\centering{\includegraphics[width=0.30\textwidth]{fig3_2full.eps}}
\caption{WPTERD instance without practical schedules assuring energy optimality.}
\label{fig_full}
\end{figure}

\vspace{-4mm}
\begin{figure}[htb]
\centering{\includegraphics[width=0.35\textwidth]{fig4_2full_sch.eps}}
\caption{Energy changing processes along time of a $\epsilon${-}scheme schedule.}
\label{fig_full_sch}
\end{figure}

\section{Solve the WPTERD Problem}
\label{sec_algcombin}
Based on the analyses in previous sections, we propose an algorithm to solve the WPTERD problem by combining the preliminary algorithms proposed. The outline of the final algorithm is already demonstrated in Fig.~\ref{fig_outline}. The algorithm decouples the energy-time joint optimization into the WPTERD-Egy problem and the WPTERD-Time problem, which focus exclusively on the optimization in energy and time, respectively. The graph-coloring inspired LNSWL-SS algorithm is the core of our algorithm, hence we name it Graph-Coloring inspired Energy-Time decoupling (GC-EgyTimeD) algorithm. The pseudo code of GC-EgyTimeD is shown in Alg.\ref{Alg_EgyTimeD}.  GC-EgyTimeD firstly solve the \textbf{P3} problem using mature LP optimization softwares to obtain $\mathbf{t}$. Then, it obtains $S_\text{cts}$ by using the LNSWL-SS algorithm to solve the corresponding ETTS problem, and at last generates a schedule $ST_\text{ss}$ from $S_\text{cts}$ by using the ETCS-S algorithm.

\begin{algorithm}[!htb]
\caption{The GC-EgyTimeD algorithm}
\begin{algorithmic}[1]\label{Alg_EgyTimeD}
    \REQUIRE $\mathbf{e_B}, \mathbf{e_U}, \mathbf{e_L}, \mathbf{e_E}, \mathbf{C}, \mathbf{p}$;\\
    \ENSURE $ST_\text{ss}$: the (set,time) schedule sequence;\\
    \STATE $[\mathbf{t}]${=}solveP3($\mathbf{e_B}, \mathbf{e_O},\mathbf{e_U},\mathbf{C}, \mathbf{p}$);\\
    \STATE Construct ETTS problem using $\mathbf{t}$ and create $G(V,E,W)$;
    \STATE $[S_\text{cts}]{=}$LNSWL-SS$(G(V,E,W)$;
    \STATE $[ST_\text{ss}]{=}$ETCS-S$(S_\text{cts},\mathbf{e_B}, \mathbf{e_U}, \mathbf{e_L}, \mathbf{e_E}, \mathbf{C}, \mathbf{p})$;
    \STATE \textbf{return} $ST_\text{ss}$;
\end{algorithmic}
\end{algorithm}

\textit{By using GC-EgyTimeD to carefully schedule the energy transmissions of the nodes in WSNs, we are able redistribute energy in the network, which implicitly realizes the multi-hop energy flow efficiently yet easily. Meanwhile, the broadcasting nature of radio signals is well exploited to achieve the most energy efficiency.}

\section{Performance Evaluation}
\label{sec_sim}
\subsection{Performance Metrics}
We conduct numerical simulations using Matlab 2015a on a computer with Win10-bit64, 2.21GHz i7-CPU, and 8GB Memory. Three performance metrics are used: \textit{Energy Loss Ratio}, \textit{Makespan}, and \textit{Switch Number}. The energy loss ratio metric is calculated as  $\frac{\sum_{i{\in}\mathcal{N}(n)}(e_\text{B}(i){-}e_\text{F}(i))}{\sum_{i{\in}\mathcal{N}(n),e_\text{E}(i){>}e_\text{B}(i)}(e_\text{E}(i){-}e_\text{B}(i))}$   , which implies the side 'cost' for redistribute energy in the network. The makespan metric represents the time-span of a schedule. The switch number metric represents the number of continuous energy transmissions slices of the nodes in the schedule, which is obtained by counting the starts of energy transmissions. This metric implies the number of node-status changes in a schedule. We obviously prefer algorithms with smaller energy loss ratio, smaller makespan, and smaller switch number.

\subsection{Simulation Setup}
For comparison purpose, besides GC-EgyTimeD, we implement another algorithm denoted as AlgNoConCur, where the nodes transmit energy one by one, \textit{i.e.}, no concurrency energy transmissions even for non-neighboring nodes. In AlgNoConCur, the time-length of each continuous energy transmission slice is determined in a way similar to that in ETCS-S in Alg.~\ref{Alg_ETCS_S}. Additionally, it is obvious that the maximum clique-weight of the weighted graph $G(V,E,W)$ of the ETTS problem is a lower bound for the makespan of an optimal schedule. We use a greedy-based algorithm denoted as LBClique to approximately solve the maximum clique-weight problem and use it as a baseline for performance evaluation. Thus, totally three algorithms are tested in our simulations: GC-EgyTimeD, AlgNoConCur, LBClique.

Main parameters and the default values in our simulations include \textit{number of nodes} $n{=}100$, \textit{side length} $L{=}10$ of the square network region, \textit{energy transmission power} $p{=}1$, \textit{ratio of energy-demanding nodes} $\eta{=}0.3$, and \textit{the amount of energy demanded by these energy-demanding nodes} is $e_\text{h}{=}5$, $e_\text{U}{=}100$, $e_\text{L}{=}20$, $e_\text{E,L}{=}30$,$e_\text{E,U}{=}90$. The energy harvesting mode parameters are set as $\alpha{=}0.3$, $\beta{=}1$, $\gamma{=}2$, and $D{=}4$. A set of particular values for these parameters is called a \textbf{simulation configuration}. For each simulation configuration, 300 problem instances are generated and treated using the tested algorithms in turn. The WPTERD-Egy problem of randomly generated WSNs may have no LP solutions at all, in such cases new problem instances are generated repeatedly until a valid problem instance is obtained. In each problem instance, $n$ nodes are randomly placed in the square region $L{\times}L$ (Although our analysis applies to 3D space, we restrict our simulations to 2D space, which does not damage the effectiveness of the simulations). $e_\text{B}(i)$, $i{\in}\mathcal{N}(n)$, are randomly selected in $[e_\text{E,L},e_\text{E,U})$ following the uniform distribution. Randomly select ${\lceil}n{*}\eta{\rceil}$ energy-demanding nodes and set $e_\text{E}(i)$ of each selected node to be $e_\text{B}(i){+}e_\text{h}$. The others nodes' energy expectations are set to $e_\text{E,L}$. Results of the performance metrics are collected and averaged to obtain the final results for the simulation configurations. The 95\% confidence intervals of the performance metrics are also calculated.

\subsection{Simulation Results}

In our simulation experiments, the effects of a parameter on the algorithms' performances are obtained by performing a simulation set consisting of similar simulation configurations. The simulation configurations in such a simulation set only different in the value of this selected parameter, whereas all other parameters take default values. We conduct simulation experiments for inspecting the effects of the main parameters. All simulation results verify the efficiency of our algorithm. Here we only provide the simulation results for parameter $n$ because of space limitation.

In the simulation experiment for $n$, we let $n$ take values from 10 to 100 with step size 10. The results are shown in Fig.\ref{fig_sim_n}. The metrics of energy loss ratio and switch number do not applies to LBClique. Since that the other two algorithms make schedules based the shared solution $t$ of \textbf{P3}, there are no differences in the energy loss ratio metric, as shown in Fig.\ref{fig_sim_n}(a). As $n$ increases, the energy loss ratio decreases quickly. This is reasonable since that, with higher node density, the energy harvesting coefficients will be much larger, and more nodes will be able to harvest energy from a single energy transmission. These two factors both lead to less energy loss. The results in Fig.\ref{fig_sim_n}(b) show that, GC-EgyTimeD usually obtains makespans no more than 115\% of LBClique. These results imply that the solutions of GC-EgyTimeD are nearly optimal. Compared with AlgNoConCur, the makespan metric of GC-EgyTimeD is decreased by more than 65\% when $n{=}100$, and it becomes more effective in this metric as $n$ increases. These results imply that GC-EgyTimeD can exploit concurrent energy transmission opportunities well. This is obtained at the cost of more node-status switches, as shown in Fig.\ref{fig_sim_n}(c). Compared with AlgNoConCur, when $n{=}100$, GC-EgyTimeD incurs about 2.3 times more switches.

\begin{figure*}[!htbp]
\centering{
\begin{minipage}[c]{0.32\textwidth}
\centering{\includegraphics[width=\textwidth]{sim_n100_egy.eps}}
\parbox{\linewidth}{\centering\small{(a)energy loss ratio}}
\end{minipage}%
\hspace{0.01\textwidth}%
\begin{minipage}[c]{0.32\textwidth}
\centering{\includegraphics[width=\textwidth]{sim_n100_makespan.eps}}
\parbox{\linewidth}{\centering\small{(b)makespan}}
\end{minipage}
\hspace{0.01\textwidth}%
\begin{minipage}[c]{0.32\textwidth}
\centering{\includegraphics[width=\textwidth]{sim_n100_switchnum.eps}}
\parbox{\linewidth}{\centering\small{(c)switch number}}
\end{minipage}
}
\caption{Effects of node number $n$ on performance metrics of the algorithms.}
\label{fig_sim_n}
\end{figure*}


\section{Conclusion}
\label{sec_conclusion}
In this paper, we investigated WPTERD problem for redistributing energy among nodes optimally in energy efficiency and time. Inspired by a graph coloring algorithm, we propose GC-EgyTimeD to solve the WPTERD problem by decoupling the energy-time joint optimization into two problems WPTERD-Egy and WPTERD-Time. They focus exclusively on the optimization in energy and time, respectively. We transform WPTERD-Egy as a linear programming (LP) problem by exploiting its properties, and obtain optimal time-lengths of the nodes' energy transmissions leading to minimum energy lost. Then the WPTERD-Time is solved to obtain an energy transmission schedule with quasi-minimum makespan. Numerical simulations illustrate the effectiveness and efficiency of GC-EgyTimeD, which return schedules with minimum energy lost and approximately minimum makespan.


% use section* for acknowledgement
\section*{Acknowledgment}
This research was funded by Natural Science Foundation of China (No.XXXXXXXX, XXXXXXXX, XXXXXXXX).

\ifCLASSOPTIONcaptionsoff
  \newpage
\fi


\begin{thebibliography}{11}
% You can use other form of bib file by changing here...

\bibitem{Guo2017}
P. Guo, X. F. Liu, S. J. Tang, J. N. Cao, "Concurrently wireless charging sensor networks with efficient scheduling," \textit{IEEE Transactions on Mobile Computing}, vol.16, no.9, pp.2450-2463, Sep. 2017.

\bibitem{Nintana2012}
P. Nintanavongsa, U. Muncuk, D. R. Lewis, and K. R. Chowdhury, "Design optimization and implementation for RF energy harvesting circuits," \textit{IEEE Journal on Emerging and Selected Topics in Circuits and Systems}, vol.2, no.1, pp.24-33, 2012.

\bibitem{Kurs2007}
A. Kurs, A. Karalis, R. Moffatt, J. D. Joannopoulos, P. Fisher, and M. Soljacic, "Wireless power transfer via strongly coupled magnetic resonances", \textit{Science}, vol.317, no.5834, pp.83-86, 2007.

\bibitem{Cannon2009}
B. Cannon, J. Hoburg, D. Stancil, and S. Goldstein, "Magnetic resonant coupling as a potential means for wireless power transfer to multiple small receivers", \textit{IEEE Transactions on Power Electronics}, vol.24, no.7, pp.1819-1825, July 2009.

\bibitem{Xiang2013}
L. Xiang, J. Luo, K. Han, and G. T. Shi, "Fueling wireless networks perpetually: a case of multi-hop wireless power distribution," in \textit{Proc. IEEE 24th Annual International Symposium on Personal, Indoor, and Mobile Radio Communications (PIMRC2013)}, London, UK, 8-11 Sep. 2013, pp.1994-1999.

\bibitem{Rault2013}
T. Rault, A. Bouabdallah, Y. Challal, "Multi-hop wireless charging optimization in low-power networks," IEEE Global Communications Conference(GlobeCom2013), Atlanta, USA, 2013, pp.484-489.

\bibitem{Guo2016}
P. Guo, X. F. Liu, T. F. Tang, S. J. Tang, J. N. Cao, "Practical concurrent wireless charging scheduling for sensor networks," in \textit{Proc. IEEE 36th International Conference on Distributed Computing Systems(ICDCS2016)}, Nara, Japan, 27-30 Jun. 2016, pp.741-742.

\bibitem{Bulut2014}
E. Bulut, M. E. Ahsen, B. K. Szymanski, "Opportunistic wireless charging for mobile social and sensor networks", in \textit{Proc. IEEE 6th International Workshop on Management of Emerging Networks and Services(Globecom2014)}, Austin, USA, 8-12 Dec. 2014, pp.207-212.

\bibitem{Niko2016}
S. Nikoletseas, T. P. Raptis, C. Raptopoulos, "Energy balance with peer-to-peer wireless charging," in \textit{Proc. IEEE 13th International Conference on Mobile Ad Hoc and Sensor Systems(MASS2016)}, Brasilia, Brazil, 10-13 Oct. 2016, pp.101-108.

\bibitem{Niko2017}
S. Nikoletseas, T. P. Raptis, C. Raptopoulos, "Wireless charging for weighted energy balance in populations of mobile peers," \textit{Ad Hoc Networks}, vol.60, pp.1-10, 2017.

\bibitem{Madhja2016}
A. Madhja, S. Nikoletseas, C. Raptopoulos, "Energy aware network formation in peer-to-peer wireless power transfer," in \textit{Proc. ACM 19th International Conference on Modeling, Analysis and Simulation of Wireless and Mobile Systems (MSWiM2016)}, Malta, Nov. 13-17, 2016, pp.43-50.

\bibitem{Madhja2017}
A. Madhja, S. Nikoletseas, T. P. Raptis, C. Raptopoulos, and D. Tsolovos, "Peer-to-peer wireless energy transfer in populations of very weak mobile nodes," in \textit{Proc. IEEE Wireless Communications and Networking Conference Workshops (WCNCW2017)}, San Francisco, USA, 19-22 Mar. 2017, pp.1-6.

\bibitem{Marx2004}
D$\acute{a}$niel Marx, "Graph colouring problems and their applications in scheduling," \textit{Periodica Polytechnica SER. EL. ENG.}, vol.48, no.1, pp.11-16, 2004.

\bibitem{He2013}
S. He, J. Chen, F. Jiang, D. K. Y. Yau, G. Xing, and Y. Sun, "Energy provisioning in wireless rechargeable sensor networks," \textit{IEEE Transactions on Mobile Computing}, vol.12, no.10, pp.1931-1942, Oct. 2013.

\bibitem{Dai2017TON}
H. P. Dai, Y. H. Liu, G. H. Chen, X. B. Wu, T. He, A. X. Liu, H. Z. Ma, "Safe charging for wireless power transfer," \textit{IEEE/ACM Transactions on Networking}, vol.25, no.6, pp.3531-3544, Dec. 2017.

\bibitem{Dai2018TON}
H. P. Dai, H. Z. Ma, A. X. Liu, and G. H. Chen, "Radiation constrained scheduling of wireless charging tasks," \textit{IEEE/ACM Transactions on Networking}, vol.26, No.1, pp.314-326, Feb. 2018.

\bibitem{Garey1979}
M. R. Garey, and D. S. Johnson, "Computers and intractability," \textit{A Guide to the Theory of NP-Completeness}, W. H. Freeman and Company, New York, 1979.

\bibitem{Arora1998}
S. Arora, C. Lund, R. Motwani, M. Sudan, and M. Szegedy, "Proof verification and the hardness of approximation problems," \textit{Journal of the ACM}, vol.45, no.3, pp.501-555, May 1998.

\bibitem{Marathe1995}
M.V. Marathe, H. Breu, H.B. Hunt, S.S. Ravi, D. J. Rosenkrantz, "Simple heuristics for unit disk graphs," \textit{Networks}, vol.25, no.2, pp.59-68, Mar. 1995.

\end{thebibliography}


%It is not necessary to upload the biography when you submit your manuscript.


\end{document}
